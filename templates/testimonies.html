<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ title }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <!-- Bootstrap CSS for styling -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Custom shrine styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="bg-light">
    <div class="container py-5">
        <!-- Shrine title -->
        <h1 class="text-center mb-4">{{ title }}</h1>

        {% if testimonies %}
        <div class="row">
            {% for t in testimonies %}
            <div class="col-md-6 mb-4">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <!-- Testimony title and caption -->
                        <h5 class="card-title">{{ t.title }}</h5>
                        <p class="card-text">{{ t.caption }}</p>

                        <!-- Basic metadata from the database -->
                        <ul class="list-unstyled small text-muted">
                            <li><strong>Genre:</strong> {{ t.genre }}</li>
                            <li><strong>BPM:</strong> {{ t.bpm }}</li>
                            <li><strong>Language:</strong> {{ t.language }}</li>
                            <li><strong>Submitted:</strong> {{ t.timestamp.strftime("%A, %d %B %Y at %I:%M %p") }}</li>
                            <li><strong>IP:</strong> {{ t.ip_address }}</li>
                        </ul>

                        <!-- Audio playback block -->
                        {% if t.audio_filename %}
                        <div class="mt-3">
                            <audio controls class="w-100">
                                <!-- Render-friendly direct path (no subfolder) -->
                                <source src="{{ url_for('static', filename=t.audio_filename) }}" type="audio/mpeg">
                                Your browser does not support the audio element.
                            </audio>
                            <p class="text-muted small mt-2">ðŸŽ§ {{ t.title }} â€” press play to hear the scroll</p>
                        </div>
                        {% endif %}

                        <!-- Poetic metadata from get_song_by_id -->
                        {% if t.metadata %}
                        <div class="mt-3">
                            <p class="text-muted"><em>{{ t.metadata.subtitle }}</em></p>
                            <ul class="list-unstyled small text-muted">
                                <li><strong>Theme:</strong> {{ t.metadata.theme }}</li>
                                <li><strong>Visual Style:</strong> {{ t.metadata.cover_style }}</li>
                                <li><strong>Cover Caption:</strong> {{ t.metadata.cover_caption }}</li>
                                <li><strong>Authors:</strong> {{ t.metadata.authors }}</li>
                                <li><strong>Languages:</strong> {{ t.metadata.language }}</li>
                            </ul>
                            <!-- External link to Suno scroll -->
                            <a href="{{ t.metadata.suno_link }}" class="btn btn-sm btn-outline-primary" target="_blank">ðŸŽ§ Listen on Suno</a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <!-- Message if no testimonies are present -->
        <p class="text-center text-muted">No testimonies have been offered yet.</p>
        {% endif %}

        <!-- ðŸŒ¿ Return to Altar -->
        <div class="text-center mt-4">
            <a href="/" class="btn btn-outline-secondary">Return to Shrine</a>
        </div>
    </div>
</body>
</html>

